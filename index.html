<html>
    <head>
        <script src="bose-ar-web-sdk.min.js"></script>
         <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js" type="text/javascript"></script>

    </head>

    <style>
        input {
            width: 50px
        }
    </style>

    <body>
        <bose-ar-device></bose-ar-device>
        
        <div id=dataContainer style="display: none ">

            <h1>Bose Frames - (jc - 10.1)</h1>

            <h2>Sensor Data</h2>

            <form id=accelerometerContainer>
                <h3>Accelerometer</h3>

                <select size="6" style="overflow: hidden" oninput="boseARDeviceElement.setAttribute('accelerometer', this.value)">
                    <option selected value=0>disabled</option>
                    <option value=20>very fast (20ms)</option>
                    <option value=40>fast (40ms)</option>
                    <option value=80>normal (80ms)</option>
                    <option value=160>slow (160ms)</option>
                    <option value=320>very slow (320ms)</option>
                </select>

                <br>
                <br>

                <label for=accelerometerX>x</label>
                <input id=accelerometerX readonly>

                <label for=accelerometerY>y</label>
                <input id=accelerometerY readonly size=2>

                <label for=accelerometerZ>z</label>
                <input id=accelerometerZ readonly size=2>

                <br>
                <br>

                <label for=accelerometerTimestamp>timestamp</label>
                <input id=accelerometerTimestamp readonly size=2>

            </form>

            <form id="Gyroscope">
                <h3>Gyroscope</h3>
                <select size="6" style="overflow: hidden" oninput="boseARDeviceElement.setAttribute('gyroscope', this.value)">
                    <option selected value=0>disabled</option>
                    <option value=20>very fast (20ms)</option>
                    <option value=40>fast (40ms)</option>
                    <option value=80>normal (80ms)</option>
                    <option value=160>slow (160ms)</option>
                    <option value=320>very slow (320ms)</option>
                </select>

                <br>
                <br>

                <label for=gyroscopeX>x</label>
                <input id=gyroscopeX readonly size=2>

                <label for=gyroscopeY>y</label>
                <input id=gyroscopeY readonly size=2>

                <label for=gyroscopeZ>z</label>
                <input id=gyroscopeZ readonly size=2>

                <br>
                <br>

                <label for=gyroscopeTimestamp>timestamp</label>
                <input id=gyroscopeTimestamp size=2>
            </form>

            <form id="Rotation">
                <h3>Rotation</h3>
                <select size="6" style="overflow: hidden" oninput="boseARDeviceElement.setAttribute('rotation', this.value)">
                    <option selected value=0>disabled</option>
                    <option value=20>very fast (20ms)</option>
                    <option value=40>fast (40ms)</option>
                    <option value=80>normal (80ms)</option>
                    <option value=160>slow (160ms)</option>
                    <option value=320>very slow (320ms)</option>
                </select>

                <br>
                <br>

                <label for=rotationX>x</label>
                <input id=rotationX readonly size=2>

                <label for=rotationY>y</label>
                <input id=rotationY readonly size=2>

                <label for=rotationZ>z</label>
                <input id=rotationZ readonly size=2>

                <label for=rotationW>w</label>
                <input id=rotationW readonly size=2>

                <br>
                <br>

                <label for=rotationPitch>pitch</label>
                <input id=rotationPitch readonly size=2>

                <label for=rotationRoll>roll</label>
                <input id=rotationRoll readonly size=2>

                <label for=rotationYaw>yaw</label>
                <input id=rotationYaw readonly size=2>

                <br>
                <br>

                <label for=rotationTimestamp>timestamp</label>
                <input id=rotationTimestamp readonly size=2>
            </form>

            
            <form id="Game Rotation">
                <h3>Game Rotation</h3>
                <select size="6" style="overflow: hidden" oninput="boseARDeviceElement.setAttribute('game-rotation', this.value)">
                    <option selected value=0>disabled</option>
                    <option value=20>very fast (20ms)</option>
                    <option value=40>fast (40ms)</option>
                    <option value=80>normal (80ms)</option>
                    <option value=160>slow (160ms)</option>
                    <option value=320>very slow (320ms)</option>
                </select>

                <br>
                <br>

                <label for=gameRotationX>x</label>
                <input id=gameRotationX readonly size=2>

                <label for=gameRotationY>y</label>
                <input id=gameRotationY readonly size=2>

                <label for=gameRotationZ>z</label>
                <input id=gameRotationZ readonly size=2>

                <label for=gameRotationW>w</label>
                <input id=gameRotationW readonly size=2>

                <br>
                <br>

                <label for=gameRotationPitch>pitch</label>
                <input id=gameRotationPitch readonly size=2>

                <label for=gameRotationRoll>roll</label>
                <input id=gameRotationRoll readonly size=2>

                <label for=gameRotationYaw>yaw</label>
                <input id=gameRotationYaw readonly size=2>

                <br>
                <br>

                <label for=gameRotationTimestamp>timestamp</label>
                <input id=gameRotationTimestamp readonly size=2>
            </form>

            <hr>

            <h2>Gesture Data</h2>

            <form id="SingleTap">
                <h3>Single Tap (Waiting for a firmware update from Bose)</h3>

                <select disabled size="2" style="overflow: hidden" oninput="(this.value == 'enable')? boseARDeviceElement.setAttribute('single-tap', ''):boseARDeviceElement.removeAttribute('single-tap')">
                    <option selected value=disable>disable</option>
                    <option value=enable>enable</option>
                </select>

                <br>
                
                <div id=singleTapNotifications style="width: 500px; border: solid">

                </div>  
            </form>

            <form id="DoubleTap">
                <h3>Double Tap</h3>

                <select size="2" style="overflow: hidden" oninput="(this.value == 'enable')? boseARDeviceElement.setAttribute('double-tap', ''):boseARDeviceElement.removeAttribute('double-tap')">
                    <option selected value=disable>disable</option>
                    <option value=enable>enable</option>
                </select>

                <br>
                
                <div id=doubleTapNotifications style="width: 500px; border: solid">

                </div>  
            </form>

            <form id="HeadNod">
                <h3>Head Nod</h3>

                <select size="2" style="overflow: hidden" oninput="(this.value == 'enable')? boseARDeviceElement.setAttribute('head-nod', ''):boseARDeviceElement.removeAttribute('head-nod')">
                    <option selected value=disable>disable</option>
                    <option value=enable>enable</option>
                </select>

                <br>
                
                <div id=headNodNotifications style="width: 500px; border: solid">

                </div>  
            </form>

            <form id="HeadShake">
                <h3>Head Shake</h3>

                <select size="2" style="overflow: hidden" oninput="(this.value == 'enable')? boseARDeviceElement.setAttribute('head-shake', ''):boseARDeviceElement.removeAttribute('head-shake')">
                    <option selected value=disable>disable</option>
                    <option value=enable>enable</option>
                </select>

                <br>
                
                <div id=headShakeNotifications style="width: 500px; border: solid">

                </div>  
            </form>
        </div>

        <script>
        //Using the HiveMQ public Broker, with a random client Id
        var client = new Paho.Client("broker.mqttdashboard.com", 8000, "myclientid_" + parseInt(Math.random() * 100, 10));

        //Gets  called if the websocket/mqtt connection gets disconnected for any reason
        client.onConnectionLost = function (responseObject) {
        //Depending on your scenario you could implement a reconnect logic here
        alert("connection lost: " + responseObject.errorMessage);
        };

        //Gets called whenever you receive a message for your subscriptions
        client.onMessageArrived = function (message) {
        //Do something with the push message you received
        $('#messages').append('<span>Topic: ' + message.destinationName + '  | ' + message.payloadString + '</span><br/>');
        };

        //Connect Options
        var options = {
            timeout: 3,
            //Gets Called if the connection has sucessfully been established
            onSuccess: function () {
            alert("Connected");
        },
        //Gets Called if the connection could not be established
        onFailure: function (message) {
         alert("Connection failed: " + message.errorMessage);
        }
    };

    //Creates a new Messaging.Message Object and sends it to the HiveMQ MQTT Broker
    var publish = function (payload, topic, qos) {
        //Send your message (also possible to serialize it as JSON or protobuf or just use a string, no limitations)
        var message = new Paho.Message(payload);
        message.destinationName = topic;
        message.qos = qos;
        client.send(message);
    }


            boseARDeviceElement.addEventListener("connect", event => {
                dataContainer.style.display = '';
            });

            boseARDeviceElement.addEventListener("accelerometer", event => {
                accelerometerX.value = Number(boseARDeviceElement.getAttribute("accelerometerX")).toFixed(3);
                accelerometerY.value = Number(boseARDeviceElement.getAttribute("accelerometerY")).toFixed(3);
                accelerometerZ.value = Number(boseARDeviceElement.getAttribute("accelerometerZ")).toFixed(3);

                accelerometerTimestamp.value = boseARDeviceElement.getAttribute("accelerometerTimestamp");
            });
            boseARDeviceElement.addEventListener("gyroscope", event => {
                gyroscopeX.value = Number(boseARDeviceElement.getAttribute("gyroscopeX")).toFixed(3);
                gyroscopeY.value = Number(boseARDeviceElement.getAttribute("gyroscopeY")).toFixed(3);
                gyroscopeZ.value = Number(boseARDeviceElement.getAttribute("gyroscopeZ")).toFixed(3);

                gyroscopeTimestamp.value = boseARDeviceElement.getAttribute("gyroscopeTimestamp");
            });
            boseARDeviceElement.addEventListener("rotation", event => {
                rotationX.value = Number(boseARDeviceElement.getAttribute("rotationX")).toFixed(3);
                rotationY.value = Number(boseARDeviceElement.getAttribute("rotationY")).toFixed(3);
                rotationZ.value = Number(boseARDeviceElement.getAttribute("rotationZ")).toFixed(3);                
                
                rotationW.value = Number(boseARDeviceElement.getAttribute("rotationW")).toFixed(3);

                rotationPitch.value = Number(boseARDeviceElement.getAttribute("rotationPitch")).toFixed(3);
                rotationRoll.value = Number(boseARDeviceElement.getAttribute("rotationRoll")).toFixed(3);
                rotationYaw.value = Number(boseARDeviceElement.getAttribute("rotationYaw")).toFixed(3);

                rotationTimestamp.value = boseARDeviceElement.getAttribute("rotationTimestamp");
            });
            boseARDeviceElement.addEventListener("gameRotation", event => {
                gameRotationX.value = Number(boseARDeviceElement.getAttribute("gameRotationX")).toFixed(3);
                gameRotationY.value = Number(boseARDeviceElement.getAttribute("gameRotationY")).toFixed(3);
                gameRotationZ.value = Number(boseARDeviceElement.getAttribute("gameRotationZ")).toFixed(3);                
                
                gameRotationW.value = Number(boseARDeviceElement.getAttribute("gameRotationW")).toFixed(3);

                gameRotationPitch.value = Number(boseARDeviceElement.getAttribute("gameRotationPitch")).toFixed(3);
                gameRotationRoll.value = Number(boseARDeviceElement.getAttribute("gameRotationRoll")).toFixed(3);
                gameRotationYaw.value = Number(boseARDeviceElement.getAttribute("gameRotationYaw")).toFixed(3);

                gameRotationTimestamp.value = boseARDeviceElement.getAttribute("gameRotationTimestamp");
            });

            boseARDeviceElement.addEventListener("singleTap", event => {
                singleTapNotifications.innerText +=
                    "Gesture Type: " + "Single Tap" +
                    "\nTimestamp: " + boseARDeviceElement.getAttribute("singleTapTimestamp") + '\n\n';
            });
            boseARDeviceElement.addEventListener("doubleTap", event => {
                doubleTapNotifications.innerText +=
                    "Gesture Type: " + "Double Tap" +
                    "\nTimestamp: " + boseARDeviceElement.getAttribute("doubleTapTimestamp") + '\n\n';
            });
            boseARDeviceElement.addEventListener("headNod", event => {
                headNodNotifications.innerText +=
                    "Gesture Type: " + "Head Nod" +
                    "\nTimestamp: " + boseARDeviceElement.getAttribute("headNodTimestamp") + '\n\n';
            });
            boseARDeviceElement.addEventListener("headShake", event => {
                headShakeNotifications.innerText +=
                    "Gesture Type: " + "Head Shake" +
                    "\nTimestamp: " + boseARDeviceElement.getAttribute("headShakeTimestamp") + '\n\n';
            });
        </script>
    </body>
</html>



